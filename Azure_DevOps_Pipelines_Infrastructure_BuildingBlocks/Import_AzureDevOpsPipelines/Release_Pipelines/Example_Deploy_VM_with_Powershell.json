{"source":2,"revision":3,"description":null,"createdBy":{"displayName":"Jim Riekse","url":"https://spsprodcus1.vssps.visualstudio.com/A0b9d401a-88c6-4895-a1aa-65fe002d550b/_apis/Identities/94b2a4ec-475a-4c49-af60-a36150525285","_links":{"avatar":{"href":"https://dev.azure.com/jriekse55550912/_apis/GraphProfile/MemberAvatars/msa.MzVjMTU4NWYtOTBlOC03NTg4LWI1ODItYTgxNGEyZjU0MDg4"}},"id":"94b2a4ec-475a-4c49-af60-a36150525285","uniqueName":"jriekse5555@hotmail.com","imageUrl":"https://dev.azure.com/jriekse55550912/_api/_common/identityImage?id=94b2a4ec-475a-4c49-af60-a36150525285","descriptor":"msa.MzVjMTU4NWYtOTBlOC03NTg4LWI1ODItYTgxNGEyZjU0MDg4"},"createdOn":"2019-03-15T15:11:24.970Z","modifiedBy":{"displayName":"Jim Riekse","url":"https://spsprodcus1.vssps.visualstudio.com/A0b9d401a-88c6-4895-a1aa-65fe002d550b/_apis/Identities/94b2a4ec-475a-4c49-af60-a36150525285","_links":{"avatar":{"href":"https://dev.azure.com/jriekse55550912/_apis/GraphProfile/MemberAvatars/msa.MzVjMTU4NWYtOTBlOC03NTg4LWI1ODItYTgxNGEyZjU0MDg4"}},"id":"94b2a4ec-475a-4c49-af60-a36150525285","uniqueName":"jriekse5555@hotmail.com","imageUrl":"https://dev.azure.com/jriekse55550912/_api/_common/identityImage?id=94b2a4ec-475a-4c49-af60-a36150525285","descriptor":"msa.MzVjMTU4NWYtOTBlOC03NTg4LWI1ODItYTgxNGEyZjU0MDg4"},"modifiedOn":"2019-03-15T15:28:38.687Z","isDeleted":false,"variables":{"localPass":{"value":"P@ssw0rd123456"},"localUser":{"value":"localUser"},"Location":{"value":"EastUS"},"Network":{"value":"BuildingBlocks"},"ResourceGroup":{"value":"BuildingBlocks"},"Subnet":{"value":"Subnet1"},"VMName":{"value":"BuildingBlocks"},"VMSize":{"value":"Standard_B2s"}},"variableGroups":[],"environments":[{"id":2,"name":"Stage 1","rank":1,"owner":{"displayName":"Jim Riekse","url":"https://spsprodcus1.vssps.visualstudio.com/A0b9d401a-88c6-4895-a1aa-65fe002d550b/_apis/Identities/94b2a4ec-475a-4c49-af60-a36150525285","_links":{"avatar":{"href":"https://dev.azure.com/jriekse55550912/_apis/GraphProfile/MemberAvatars/msa.MzVjMTU4NWYtOTBlOC03NTg4LWI1ODItYTgxNGEyZjU0MDg4"}},"id":"94b2a4ec-475a-4c49-af60-a36150525285","uniqueName":"jriekse5555@hotmail.com","imageUrl":"https://dev.azure.com/jriekse55550912/_api/_common/identityImage?id=94b2a4ec-475a-4c49-af60-a36150525285","descriptor":"msa.MzVjMTU4NWYtOTBlOC03NTg4LWI1ODItYTgxNGEyZjU0MDg4"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":4}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":5},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":6}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":4,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent job","refName":null,"workflowTasks":[{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"3.*","name":"Create Resource Group","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"780b6ee2-01eb-4393-946b-ab516a90829f","ScriptType":"InlineScript","ScriptPath":"","Inline":"#Note all variables with the syntax \"$()\" are DevOps variables that need to predefined\n\n# Create Resource Group\nNew-AzureRMResourceGroup -Name \"$(ResourceGroup)\" -Location \"$(Location)\"","ScriptArguments":"","errorActionPreference":"silentlyContinue","FailOnStandardError":"false","TargetAzurePs":"LatestVersion","CustomTargetAzurePs":""}},{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"3.*","name":"Create Virtual Network and Subnet","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"780b6ee2-01eb-4393-946b-ab516a90829f","ScriptType":"InlineScript","ScriptPath":"","Inline":"#Note all variables with the syntax \"$()\" are DevOps variables that need to be  predefined\n\n# Create Virtual Network\n$virtualNetwork = New-AzureRMVirtualNetwork `\n  -ResourceGroupName \"$(ResourceGroup)\" `\n  -Location \"$(Location)\" `\n  -Name \"$(Network)\" `\n  -AddressPrefix 11.0.0.0/16\n\n#Create Subnet\nAdd-AzureRMVirtualNetworkSubnetConfig `\n  -Name \"Subnet1\" `\n  -AddressPrefix 11.0.0.0/24 `\n  -VirtualNetwork $virtualNetwork\n\n#Associate subnet with virtual network\n$virtualNetwork | Set-AzureRMVirtualNetwork","ScriptArguments":"","errorActionPreference":"silentlyContinue","FailOnStandardError":"false","TargetAzurePs":"LatestVersion","CustomTargetAzurePs":""}},{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"3.*","name":"Create NIC","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"780b6ee2-01eb-4393-946b-ab516a90829f","ScriptType":"InlineScript","ScriptPath":"","Inline":"#Note all variables with the syntax \"$()\" are DevOps variables that need to be predefined\n\n# Creates variable for NIC name using DevOps variable for VMName with 'NIC' suffix\n$NICName = \"$(VMName)\" + \"NIC\"\n\n# Gets Subnet ID for NIC creation\n$vnet = Get-AzureRMVirtualNetwork -Name \"$(Network)\" -ResourceGroupName \"$(ResourceGroup)\"\n$SubnetObject = $vnet.Subnets[0].Id \n\n# Creates NIC using previous variables and DevOps variables\n$NIC = New-AzureRmNetworkInterface -Name $NICName -ResourceGroupName \"$(ResourceGroup)\" -Location \"$(Location)\" -SubnetId $SubnetObject -Force","ScriptArguments":"","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"LatestVersion","CustomTargetAzurePs":""}},{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"3.*","name":"Add Public IP to NIC","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"780b6ee2-01eb-4393-946b-ab516a90829f","ScriptType":"InlineScript","ScriptPath":"","Inline":"#Adds a public IP to a NIC\n#Note all variables with the syntax \"$()\" are DevOps variables that need to be predefined\n#Sets up Public IP object name\n$PublicIPName = \"Public-\" + \"$(VMName)\"\n#Creates Public IP object\n$PublicIP = New-AzureRmPublicIpAddress -Name $PublicIPName -ResourceGroupName \"$(ResourceGroup)\" -AllocationMethod Dynamic -Location \"$(Location)\" -Force\n\n#Sets NIC Name that was created previously\n$NICName = \"$(VMName)\" + \"NIC\"\n#Retrieves NIC object from name\n$NIC = Get-AzureRmNetworkInterface -ResourceGroupName \"$(ResourceGroup)\" -Name $NICName\n#Assign public IP object to NIC\n$nic.IpConfigurations[0].PublicIpAddress = $PublicIP\n#Updates NIC object\n$NIC | Set-AzureRmNetworkInterface","ScriptArguments":"","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"LatestVersion","CustomTargetAzurePs":""}},{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"3.*","name":"Deploy VM","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"780b6ee2-01eb-4393-946b-ab516a90829f","ScriptType":"InlineScript","ScriptPath":"","Inline":"$localPass = ConvertTo-SecureString \"$(localPass)\" -AsPlainText -Force\n$NICName = \"$(VMName)\" + \"NIC\"\n$NIC = Get-AzureRmNetworkInterface -ResourceGroupName \"$(ResourceGroup)\" -Name $NICName\n\n$Credential = New-Object System.Management.Automation.PSCredential (\"$(localUser)\", $localPass)\n\n$VirtualMachine = New-AzureRmVMConfig -VMName \"$(VMName)\" -VMSize \"$(VMSize)\"\n$VirtualMachine = Set-AzureRmVMOperatingSystem -VM $VirtualMachine -Windows -ComputerName \"$(VMName)\" -Credential $Credential -ProvisionVMAgent -EnableAutoUpdate\n$VirtualMachine = Add-AzureRmVMNetworkInterface -VM $VirtualMachine -Id $NIC.Id\n$VirtualMachine = Set-AzureRmVMSourceImage -VM $VirtualMachine -PublisherName 'MicrosoftWindowsServer' -Offer 'WindowsServer' -Skus '2016-Datacenter' -Version 'latest'\n$VirtualMachine = Set-AzureRmVMOSDisk -VM $VirtualMachine -CreateOption 'FromImage' -StorageAccountType 'Standard_LRS'  -Name \"$(VMName)-osdisk\"\n$VirtualMachine = Add-AzureRmVMDataDisk -VM $VirtualMachine -Lun 0 -CreateOption 'Empty' -Name \"$(VMName)-datadisk1\" -StorageAccountType 'Standard_LRS' -Caching None -DiskSizeinGB 127\n$VirtualMachine = Set-AzureRmVMBootDiagnostics -VM $VirtualMachine -Disable\n\nNew-AzureRmVM -ResourceGroupName \"$(ResourceGroup)\" -Location \"$(Location)\" -VM $VirtualMachine -Verbose","ScriptArguments":"","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"LatestVersion","CustomTargetAzurePs":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":3,"url":"https://vsrm.dev.azure.com/jriekse55550912/3e2617b5-1251-449c-b372-3b1f722c67b9/_apis/Release/releases/3","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://vsrm.dev.azure.com/jriekse55550912/_apis/public/Release/badge/3e2617b5-1251-449c-b372-3b1f722c67b9/2/2"}],"artifacts":[],"triggers":[],"releaseNameFormat":"Release-$(rev:r)","tags":[],"pipelineProcess":{"type":1},"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"ReleaseImport"}},"id":2,"name":"Example_Deploy_VM_with_Powershell - Copy","path":"\\","projectReference":null,"url":"https://vsrm.dev.azure.com/jriekse55550912/3e2617b5-1251-449c-b372-3b1f722c67b9/_apis/Release/definitions/2","_links":{"self":{"href":"https://vsrm.dev.azure.com/jriekse55550912/3e2617b5-1251-449c-b372-3b1f722c67b9/_apis/Release/definitions/2"},"web":{"href":"https://dev.azure.com/jriekse55550912/3e2617b5-1251-449c-b372-3b1f722c67b9/_release?definitionId=2"}}}